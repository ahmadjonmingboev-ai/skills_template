<!-- WORKSHEET TOOL - Main HTML -->
<link rel="stylesheet" href="worksheet.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<div id="worksheetApp" class="worksheet-container">
    <!-- Header -->
    <div class="worksheet-header">
        <div class="header-left">
            <h1 class="page-title">
                <svg class="title-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                Worksheet
            </h1>
        </div>
        <div class="header-right">
            <div class="user-info">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span id="currentUser">Loading...</span>
            </div>
            <button id="configButton" class="btn btn-config">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6M1 12h6m6 0h6"></path>
                    <path d="m4.93 4.93 4.24 4.24m5.66 0 4.24-4.24m0 14.14-4.24-4.24m-5.66 0-4.24 4.24"></path>
                </svg>
                Configuration
            </button>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div id="tabNavigation" class="tab-navigation">
        <!-- Tabs will be dynamically generated -->
    </div>

    <!-- Summary Stats -->
    <div class="summary-container">
        <div class="stat-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7"></path>
                <ellipse cx="12" cy="7" rx="8" ry="4"></ellipse>
            </svg>
            <span id="totalRows">0</span> Total Rows
        </div>
        <div class="stat-separator">|</div>
        <div class="stat-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <span id="selectedRows">0</span> Selected
        </div>
        <div class="stat-separator">|</div>
        <div class="stat-item stat-sum">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
            Sum: <span id="sumValue">$0.00</span>
        </div>
    </div>

    <!-- Controls Section -->
    <div class="controls-section">
        <div class="controls-left">
            <div class="search-box">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="searchInput" class="search-input" placeholder="Search all columns...">
            </div>
            <button id="filterButton" class="btn btn-secondary">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
                Filter Columns
                <span id="filterBadge" class="filter-badge" style="display: none;">0</span>
            </button>
            <button id="refreshButton" class="btn btn-secondary">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <polyline points="1 20 1 14 7 14"></polyline>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
                Refresh
            </button>
        </div>
        <div class="controls-right">
            <button id="exportButton" class="btn btn-secondary">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Export
            </button>
            <button id="addRowButton" class="btn btn-primary" style="display: none;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Row
            </button>
        </div>
    </div>

    <!-- Checkbox Actions -->
    <div class="checkbox-actions">
        <button id="selectAllButton" class="btn-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            Select All
        </button>
        <span class="separator">|</span>
        <button id="unselectAllButton" class="btn-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            </svg>
            Unselect All
        </button>
    </div>

    <!-- Table Container -->
    <div class="table-wrapper">
        <div class="table-scroll">
            <table id="dataTable" class="data-table">
                <thead id="tableHeader">
                    <!-- Headers generated dynamically -->
                </thead>
                <tbody id="tableBody">
                    <!-- Rows generated dynamically -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container">
        <div class="pagination-info">
            Showing <span id="pageStart">0</span> to <span id="pageEnd">0</span> of <span id="totalRowsPage">0</span> records
        </div>
        <div class="pagination-controls">
            <button id="firstPageBtn" class="pagination-btn">«</button>
            <button id="prevPageBtn" class="pagination-btn">‹</button>
            <div id="pageNumbers" class="page-numbers"></div>
            <button id="nextPageBtn" class="pagination-btn">›</button>
            <button id="lastPageBtn" class="pagination-btn">»</button>
        </div>
        <div class="pagination-size">
            <select id="pageSizeSelect" class="page-size-select">
                <option value="25">25 rows</option>
                <option value="50" selected>50 rows</option>
                <option value="100">100 rows</option>
                <option value="all">All</option>
            </select>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <svg class="spinner" width="50" height="50" viewBox="0 0 50 50">
                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
            </svg>
            <p>Loading data...</p>
        </div>
    </div>
</div>

<!-- Configuration Modal -->
<div id="configModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6M1 12h6m6 0h6"></path>
                </svg>
                Worksheet Configuration
            </h2>
            <button class="modal-close" onclick="closeConfigModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="config-section">
                <h3>General Settings</h3>
                <div class="form-group">
                    <label>Page ID</label>
                    <input type="text" id="configPageId" class="form-control" placeholder="123456789">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Primary Key Column</label>
                        <input type="text" id="configPrimaryKey" class="form-control" placeholder="ITEM_ID">
                    </div>
                    <div class="form-group">
                        <label>Sum Column</label>
                        <input type="text" id="configSumColumn" class="form-control" placeholder="Amount">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Theme</label>
                        <select id="configTheme" class="form-control">
                            <option value="auto">Auto (System)</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="configWriteBack">
                            Enable Write-Back (Add/Edit/Delete)
                        </label>
                    </div>
                </div>
            </div>

            <div class="config-section">
                <h3>Tab Configuration</h3>
                <div id="tabsConfigContainer">
                    <!-- Tab configs will be generated dynamically -->
                </div>
                <button id="addTabButton" class="btn btn-secondary btn-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Another Tab
                </button>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeConfigModal()">Cancel</button>
            <button id="saveConfigButton" class="btn btn-primary">Save Configuration</button>
        </div>
    </div>
</div>

<!-- Column Order Modal -->
<div id="columnOrderModal" class="modal">
    <div class="modal-content modal-medium">
        <div class="modal-header">
            <h2>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="4" y1="6" x2="20" y2="6"></line>
                    <line x1="4" y1="12" x2="20" y2="12"></line>
                    <line x1="4" y1="18" x2="20" y2="18"></line>
                </svg>
                Customize Column Order - <span id="columnOrderTabName"></span>
            </h2>
            <button class="modal-close" onclick="closeColumnOrderModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="column-order-section">
                <div class="column-lists-container">
                    <div class="available-columns">
                        <h4>Available Columns</h4>
                        <p class="help-text">Drag columns to the right to display them</p>
                        <div id="availableColumnsList" class="column-list">
                            <!-- Available columns -->
                        </div>
                    </div>
                    <div class="selected-columns">
                        <h4>Selected Columns (Display Order)</h4>
                        <p class="help-text">Drag to reorder</p>
                        <div id="selectedColumnsList" class="column-list">
                            <!-- Selected columns -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeColumnOrderModal()">Cancel</button>
            <button id="saveColumnOrderButton" class="btn btn-primary">Save Column Order</button>
        </div>
    </div>
</div>

<!-- Filter Modal -->
<div id="filterModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
                Filter Columns
            </h2>
            <button class="modal-close" onclick="closeFilterModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <p class="help-text">Hold Ctrl (Cmd on Mac) to select multiple values in dropdowns</p>
            <div id="filterColumnsContainer" class="filter-columns-grid">
                <!-- Filter columns will be generated dynamically -->
            </div>
            <div class="filter-status">
                <span id="filterStatus">No filters active</span>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="clearFilters()">Clear All</button>
            <button id="applyFiltersButton" class="btn btn-primary">Apply Filters</button>
        </div>
    </div>
</div>

<!-- Comment Modal -->
<div id="commentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                Add/Edit Comment
            </h2>
            <button class="modal-close" onclick="closeCommentModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="commentRowKey">
            <div class="form-group">
                <label>Root Cause</label>
                <textarea id="commentRootCause" class="form-control" rows="3" placeholder="Describe the root cause..."></textarea>
            </div>
            <div class="form-group">
                <label>Action</label>
                <textarea id="commentAction" class="form-control" rows="3" placeholder="What action is needed?"></textarea>
            </div>
            <div class="form-group">
                <label>ETA</label>
                <input type="text" id="commentETA" class="form-control" placeholder="DD.MM.YYYY">
            </div>
            <div class="comment-meta" id="commentMeta" style="display: none;">
                <small>Last updated by <strong id="commentUsername"></strong> on <strong id="commentTimestamp"></strong></small>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeCommentModal()">Cancel</button>
            <button id="saveCommentButton" class="btn btn-primary">Save Comment</button>
        </div>
    </div>
</div>

<!-- Edit Row Modal -->
<div id="editRowModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                <span id="editRowTitle">Edit Row</span>
            </h2>
            <button class="modal-close" onclick="closeEditRowModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body" id="editRowFormContainer">
            <!-- Form fields will be generated dynamically -->
        </div>
        <div class="modal-footer">
            <button id="deleteRowButton" class="btn btn-danger" style="display: none;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Delete Row
            </button>
            <div style="flex: 1;"></div>
            <button class="btn btn-secondary" onclick="closeEditRowModal()">Cancel</button>
            <button id="saveRowButton" class="btn btn-primary">Save</button>
        </div>
    </div>
</div>

<script src="worksheet.js"></script>
