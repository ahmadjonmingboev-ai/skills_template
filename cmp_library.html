<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CMP Library</title>
  <link rel="stylesheet" href="cmp_library.css">
</head>
<body>
  <div id="cmpLibraryApp">
    
    <!-- SVG Icon Sprite -->
    <svg style="display: none;">
      <!-- Search Icon -->
      <symbol id="icon-search" viewBox="0 0 24 24">
        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" fill="none"/>
        <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </symbol>
      
      <!-- Refresh Icon -->
      <symbol id="icon-refresh" viewBox="0 0 24 24">
        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0118.8-4.3M22 12.5a10 10 0 01-18.8 4.2" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      
      <!-- Grid Icon -->
      <symbol id="icon-grid" viewBox="0 0 24 24">
        <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" fill="none"/>
        <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" fill="none"/>
        <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" fill="none"/>
        <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" fill="none"/>
      </symbol>
      
      <!-- List Icon -->
      <symbol id="icon-list" viewBox="0 0 24 24">
        <line x1="8" y1="6" x2="21" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="8" y1="12" x2="21" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="8" y1="18" x2="21" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="3" y1="6" x2="3.01" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="3" y1="12" x2="3.01" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="3" y1="18" x2="3.01" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </symbol>
      
      <!-- Settings Icon -->
      <symbol id="icon-settings" viewBox="0 0 24 24">
        <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" stroke="currentColor" stroke-width="2" fill="none"/>
        <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke="currentColor" stroke-width="2" fill="none"/>
      </symbol>
      
      <!-- Plus Icon -->
      <symbol id="icon-plus" viewBox="0 0 24 24">
        <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </symbol>
      
      <!-- Edit Icon -->
      <symbol id="icon-edit" viewBox="0 0 24 24">
        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      
      <!-- Trash Icon -->
      <symbol id="icon-trash" viewBox="0 0 24 24">
        <polyline points="3 6 5 6 21 6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      
      <!-- Download Icon -->
      <symbol id="icon-download" viewBox="0 0 24 24">
        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      
      <!-- Close Icon -->
      <symbol id="icon-close" viewBox="0 0 24 24">
        <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </symbol>
      
      <!-- Copy Icon -->
      <symbol id="icon-copy" viewBox="0 0 24 24">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"/>
        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1" stroke="currentColor" stroke-width="2" fill="none"/>
      </symbol>
      
      <!-- Shopping Cart / Order Icon -->
      <symbol id="icon-order" viewBox="0 0 24 24">
        <circle cx="9" cy="21" r="1" stroke="currentColor" stroke-width="2" fill="none"/>
        <circle cx="20" cy="21" r="1" stroke="currentColor" stroke-width="2" fill="none"/>
        <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      
      <!-- Paperclip / Attachment Icon -->
      <symbol id="icon-attachment" viewBox="0 0 24 24">
        <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      
      <!-- User Icon -->
      <symbol id="icon-user" viewBox="0 0 24 24">
        <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      
      <!-- Clock Icon -->
      <symbol id="icon-clock" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
        <polyline points="12 6 12 12 16 14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      
      <!-- Alert Circle Icon -->
      <symbol id="icon-alert-circle" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
        <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="12" y1="16" x2="12.01" y2="16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </symbol>
      
      <!-- Check Circle Icon -->
      <symbol id="icon-check-circle" viewBox="0 0 24 24">
        <path d="M22 11.08V12a10 10 0 11-5.93-9.14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      
      <!-- X Circle Icon -->
      <symbol id="icon-x-circle" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
        <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </symbol>
      
      <!-- Filter Icon -->
      <symbol id="icon-filter" viewBox="0 0 24 24">
        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      
      <!-- Tag Icon -->
      <symbol id="icon-tag" viewBox="0 0 24 24">
        <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <line x1="7" y1="7" x2="7.01" y2="7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </symbol>
      
      <!-- App Icon (Default) -->
      <symbol id="icon-app-default" viewBox="0 0 24 24">
        <rect x="3" y="3" width="7" height="7" rx="1" fill="currentColor"/>
        <rect x="14" y="3" width="7" height="7" rx="1" fill="currentColor"/>
        <rect x="3" y="14" width="7" height="7" rx="1" fill="currentColor"/>
        <rect x="14" y="14" width="7" height="7" rx="1" fill="currentColor"/>
      </symbol>
    </svg>

    <!-- Toolbar -->
    <div class="cmp-toolbar">
      <div class="cmp-toolbar-left">
        <h1 class="cmp-title">CMP Library</h1>
      </div>

      <div class="cmp-toolbar-right">
        <div class="cmp-search-container">
          <svg class="cmp-icon cmp-icon-sm cmp-search-icon"><use href="#icon-search"></use></svg>
          <input type="text" id="searchInput" class="cmp-search-input" placeholder="Search CMP..." />
        </div>

        <button class="cmp-refresh-btn" id="refreshBtn" aria-label="Refresh data" title="Refresh">
          <svg class="cmp-icon cmp-icon-md"><use href="#icon-refresh"></use></svg>
        </button>

        <div class="cmp-view-toggle">
          <button class="cmp-view-btn active" id="gridViewBtn" aria-label="Grid view" title="Grid view">
            <svg class="cmp-icon cmp-icon-md"><use href="#icon-grid"></use></svg>
          </button>
          <button class="cmp-view-btn" id="listViewBtn" aria-label="List view" title="List view">
            <svg class="cmp-icon cmp-icon-md"><use href="#icon-list"></use></svg>
          </button>
        </div>

        <div class="cmp-config-dropdown">
          <button class="cmp-config-btn" id="configBtn" aria-label="Settings" title="Settings">
            <svg class="cmp-icon cmp-icon-md"><use href="#icon-settings"></use></svg>
          </button>
          <div class="cmp-dropdown-menu" id="configMenu">
            <button class="cmp-dropdown-item" id="addCmpBtn">
              <svg class="cmp-icon cmp-icon-sm"><use href="#icon-plus"></use></svg>
              <span>Add New CMP</span>
            </button>
            <button class="cmp-dropdown-item" id="editModeBtn">
              <svg class="cmp-icon cmp-icon-sm"><use href="#icon-edit"></use></svg>
              <span>Edit Mode</span>
            </button>
            <button class="cmp-dropdown-item" id="deleteModeBtn">
              <svg class="cmp-icon cmp-icon-sm"><use href="#icon-trash"></use></svg>
              <span>Delete Mode</span>
            </button>
            <div class="cmp-dropdown-divider"></div>
            <button class="cmp-dropdown-item" id="exportCmpsBtn">
              <svg class="cmp-icon cmp-icon-sm"><use href="#icon-download"></use></svg>
              <span>Export CMPs</span>
            </button>
            <button class="cmp-dropdown-item" id="exportAuditBtn">
              <svg class="cmp-icon cmp-icon-sm"><use href="#icon-download"></use></svg>
              <span>Export Audit Log</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Category & Region Chips Filter -->
    <div class="cmp-chips-filter">
      <div class="cmp-chips-section">
        <span class="cmp-chips-label">Categories:</span>
        <div class="cmp-chips-container" id="categoryChips"></div>
      </div>
      <div class="cmp-chips-section">
        <span class="cmp-chips-label">Regions:</span>
        <div class="cmp-chips-container" id="regionChips"></div>
      </div>
    </div>

    <!-- Filter Bar -->
    <div class="cmp-filter-bar">
      <div class="cmp-filter-group">
        <svg class="cmp-icon cmp-icon-sm"><use href="#icon-filter"></use></svg>
        <select id="sortSelect" class="cmp-filter-select">
          <option value="alphabetical">A-Z</option>
          <option value="alphabetical-desc">Z-A</option>
          <option value="newest">Newest First</option>
          <option value="oldest">Oldest First</option>
        </select>
      </div>

      <div class="cmp-filter-results">
        <span id="resultsCount">Showing 0 CMPs</span>
      </div>

      <button class="cmp-clear-filters-btn" id="clearFiltersBtn" style="display: none;">
        Clear Filters
      </button>
    </div>

    <!-- Grid View Container -->
    <div class="cmp-grid-container" id="cmpGrid"></div>

    <!-- List View Container -->
    <div class="cmp-list-container" id="cmpList" style="display: none;"></div>

    <!-- Pagination -->
    <div class="cmp-pagination" id="pagination"></div>

    <!-- Loading Skeleton -->
    <div class="cmp-skeleton-container" id="skeletonContainer" style="display: none;">
      <div class="cmp-loading-overlay">
        <div class="cmp-loading-spinner-large">
          <div class="cmp-spinner-border"></div>
        </div>
        <p class="cmp-loading-text">Loading CMPs...</p>
      </div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
      <div class="cmp-skeleton-card"></div>
    </div>

    <!-- Empty State -->
    <div class="cmp-empty-state" id="emptyState" style="display: none;">
      <svg class="cmp-empty-icon"><use href="#icon-tag"></use></svg>
      <h3 class="cmp-empty-title">No CMPs found</h3>
      <p class="cmp-empty-message">Try adjusting your search or filters</p>
      <button class="cmp-btn cmp-btn-primary" onclick="clearFilters()">Clear Filters</button>
    </div>

    <!-- Add/Edit CMP Modal -->
    <div class="cmp-modal-overlay" id="cmpModal" style="display: none;">
      <div class="cmp-modal">
        <div class="cmp-modal-header">
          <h2 class="cmp-modal-title" id="modalTitle">Add New CMP</h2>
          <button class="cmp-modal-close" onclick="closeCmpModal()">
            <svg class="cmp-icon cmp-icon-md"><use href="#icon-close"></use></svg>
          </button>
        </div>
        <div class="cmp-modal-body">
          <form id="cmpForm">
            <div class="cmp-form-row">
              <div class="cmp-form-group">
                <label for="cmpName" class="cmp-label">CMP/Access Name *</label>
                <input type="text" id="cmpName" class="cmp-input" placeholder="e.g., VPN Access, SSO Setup" required maxlength="100" />
                <div class="cmp-error" id="nameError"></div>
              </div>

              <div class="cmp-form-group">
                <label for="cmpCategory" class="cmp-label">Category *</label>
                <input type="text" id="cmpCategory" class="cmp-input" placeholder="e.g., VPN, SSO, API" required list="categoryList" />
                <datalist id="categoryList"></datalist>
                <div class="cmp-error" id="categoryError"></div>
              </div>
            </div>

            <div class="cmp-form-row">
              <div class="cmp-form-group">
                <label for="cmpRegion" class="cmp-label">Region *</label>
                <input type="text" id="cmpRegion" class="cmp-input" placeholder="e.g., US, EU, APAC, Global" required list="regionList" />
                <datalist id="regionList"></datalist>
                <div class="cmp-error" id="regionError"></div>
              </div>

              <div class="cmp-form-group">
                <label for="cmpTag" class="cmp-label">Tag (Optional)</label>
                <select id="cmpTag" class="cmp-input">
                  <option value="">No Tag</option>
                  <option value="NEW">NEW</option>
                  <option value="REQUIRED">REQUIRED</option>
                  <option value="RESTRICTED">RESTRICTED</option>
                </select>
              </div>
            </div>

            <div class="cmp-form-group">
              <label for="cmpDescription" class="cmp-label">Description *</label>
              <textarea id="cmpDescription" class="cmp-textarea" placeholder="Brief description of the access or system..." required maxlength="200" rows="2"></textarea>
              <div class="cmp-char-counter"><span id="descCharCount">0</span>/200</div>
              <div class="cmp-error" id="descriptionError"></div>
            </div>

            <div class="cmp-form-group">
              <label for="cmpInstructions" class="cmp-label">Order Instructions (Optional)</label>
              <textarea id="cmpInstructions" class="cmp-textarea" placeholder="How to request access, what information is needed..." maxlength="500" rows="3"></textarea>
              <div class="cmp-char-counter"><span id="instructionsCharCount">0</span>/500</div>
            </div>

            <div class="cmp-form-row">
              <div class="cmp-form-group">
                <label for="cmpOwner" class="cmp-label">Owner/Contact</label>
                <input type="text" id="cmpOwner" class="cmp-input" placeholder="Team or person responsible" maxlength="100" />
              </div>

              <div class="cmp-form-group">
                <label for="cmpProcessingTime" class="cmp-label">Processing Time</label>
                <input type="text" id="cmpProcessingTime" class="cmp-input" placeholder="e.g., 1-2 business days" maxlength="50" />
              </div>
            </div>

            <div class="cmp-form-group">
              <label for="cmpPrerequisites" class="cmp-label">Prerequisites (Optional)</label>
              <input type="text" id="cmpPrerequisites" class="cmp-input" placeholder="e.g., Manager approval, Security training" maxlength="200" />
            </div>

            <div class="cmp-form-group">
              <label for="cmpIcon" class="cmp-label">Icon URL (Optional)</label>
              <input type="url" id="cmpIcon" class="cmp-input" placeholder="https://example.com/icon.png" />
              <div class="cmp-error" id="iconError"></div>
            </div>

            <div class="cmp-form-group">
              <label for="cmpTemplateUrl" class="cmp-label">Template/Order URL</label>
              <input type="url" id="cmpTemplateUrl" class="cmp-input" placeholder="https://marketplace.com/template/123" />
              <div class="cmp-error" id="templateError"></div>
            </div>

            <div class="cmp-form-group">
              <label for="cmpAttachmentCode" class="cmp-label">Attachment Embed Code (.msg file from SharePoint)</label>
              <textarea id="cmpAttachmentCode" class="cmp-textarea" placeholder="Paste iframe embed code here..." rows="3"></textarea>
            </div>

            <div class="cmp-form-group">
              <label for="cmpAttachmentName" class="cmp-label">Attachment Display Name</label>
              <input type="text" id="cmpAttachmentName" class="cmp-input" placeholder="e.g., Setup Instructions.msg" maxlength="100" />
            </div>

            <input type="hidden" id="cmpId" />
          </form>
        </div>
        <div class="cmp-modal-footer">
          <button class="cmp-btn cmp-btn-secondary" onclick="closeCmpModal()">Cancel</button>
          <button class="cmp-btn cmp-btn-primary" id="saveCmpBtn" onclick="saveCmp()">Save CMP</button>
        </div>
      </div>
    </div>

    <!-- Order Template Modal -->
    <div class="cmp-modal-overlay" id="orderModal" style="display: none;">
      <div class="cmp-modal cmp-modal-large">
        <div class="cmp-modal-header">
          <h2 class="cmp-modal-title" id="orderModalTitle">Order Access</h2>
          <button class="cmp-modal-close" onclick="closeOrderModal()">
            <svg class="cmp-icon cmp-icon-md"><use href="#icon-close"></use></svg>
          </button>
        </div>
        <div class="cmp-modal-body cmp-iframe-container">
          <div id="orderIframeContainer"></div>
        </div>
      </div>
    </div>

    <!-- Attachment Preview Modal -->
    <div class="cmp-modal-overlay" id="attachmentModal" style="display: none;">
      <div class="cmp-modal cmp-modal-large">
        <div class="cmp-modal-header">
          <h2 class="cmp-modal-title" id="attachmentModalTitle">View Attachment</h2>
          <button class="cmp-modal-close" onclick="closeAttachmentModal()">
            <svg class="cmp-icon cmp-icon-md"><use href="#icon-close"></use></svg>
          </button>
        </div>
        <div class="cmp-modal-body cmp-iframe-container">
          <div id="attachmentIframeContainer"></div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="cmp-modal-overlay" id="deleteModal" style="display: none;">
      <div class="cmp-modal cmp-modal-small">
        <div class="cmp-modal-header">
          <div class="cmp-delete-warning-icon">
            <svg class="cmp-icon cmp-icon-lg"><use href="#icon-alert-circle"></use></svg>
          </div>
        </div>
        <div class="cmp-modal-body">
          <h3 class="cmp-delete-title">Delete CMP?</h3>
          <p class="cmp-delete-message">
            Are you sure you want to delete "<strong id="deleteCmpName"></strong>"?
          </p>
          <p class="cmp-delete-warning">
            This action cannot be undone. The CMP will be permanently removed from the library.
          </p>
        </div>
        <div class="cmp-modal-footer">
          <button class="cmp-btn cmp-btn-secondary" onclick="closeDeleteModal()">Cancel</button>
          <button class="cmp-btn cmp-btn-danger" id="confirmDeleteBtn" onclick="confirmDelete()">
            Delete CMP
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="cmp-toast-container" id="toastContainer"></div>

  </div>

  <script src="cmp_library.js"></script>
</body>
</html>
