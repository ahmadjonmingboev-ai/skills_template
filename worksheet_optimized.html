<!-- WORKSHEET TOOL - Optimized Version v6 with TailAdmin-inspired Design -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worksheet Tool</title>
    <link rel="stylesheet" href="worksheet_optimized.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div id="worksheetApp" class="worksheet-container">
    <!-- Header -->
    <div class="worksheet-header">
        <div class="header-left">
            <h1 class="page-title">
                <svg class="title-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                <span id="worksheetName">Worksheet</span>
            </h1>
        </div>
        <div class="header-right">
            <div class="user-info">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span id="currentUser">Loading...</span>
            </div>
            <button id="viewHistoryButton" class="btn btn-secondary" title="View History">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="1 4 1 10 7 10"></polyline>
                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                </svg>
            </button>
            <button id="configButton" class="btn btn-config" title="Settings">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6M1 12h6m6 0h6M4.22 4.22l4.24 4.24m5.66 5.66 4.24 4.24m-4.24-14.14 4.24 4.24M4.22 19.78l4.24-4.24"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Tab Navigation with Stats -->
    <div class="tab-stats-container">
        <div id="tabNavigation" class="tab-navigation"></div>
        <div class="summary-stats">
            <div class="stat-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7"></path>
                    <ellipse cx="12" cy="7" rx="8" ry="4"></ellipse>
                </svg>
                <span id="totalRows">0</span> rows
            </div>
            <div class="stat-separator">|</div>
            <div class="stat-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 11 12 14 22 4"></polyline>
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                </svg>
                <span id="selectedRows">0</span> selected
            </div>
            <div class="stat-separator">|</div>
            <div class="stat-item stat-sum">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                Sum: <span id="sumValue">0</span>
            </div>
        </div>
    </div>

    <!-- Selection & Pagination Controls -->
    <div class="selection-pagination-bar">
        <button id="selectAllButton" class="btn-link">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            Select All
        </button>
        <span class="separator">|</span>
        <button id="unselectAllButton" class="btn-link">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            </svg>
            Unselect All
        </button>
        <span class="separator">|</span>
        <select id="pageSizeSelect" class="page-size-select">
            <option value="25" selected>25 per page</option>
            <option value="50">50 per page</option>
            <option value="100">100 per page</option>
        </select>
        <span class="separator">|</span>
        <label for="groupBySelect">Group by:</label>
        <select id="groupBySelect" class="group-by-select">
            <option value="">No Grouping</option>
        </select>
        <span class="separator">|</span>
        <span class="pagination-info">
            Showing <span id="pageStart">0</span> to <span id="pageEnd">0</span> of <span id="totalRowsPage">0</span>
        </span>
    </div>

    <!-- Controls Section -->
    <div class="controls-section">
        <div class="controls-left">
            <div class="search-box">
                <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="searchInput" class="search-input" placeholder="Search all columns...">
            </div>
            <button id="filterButton" class="btn btn-secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
                Filter
                <span id="filterBadge" class="filter-badge" style="display: none;">0</span>
            </button>
            <button id="refreshButton" class="btn btn-secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <polyline points="1 20 1 14 7 14"></polyline>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
                Refresh
            </button>
        </div>
        <div class="controls-right">
            <button id="addCommentsButton" class="btn btn-secondary" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                Custom Fields
            </button>
            <button id="duplicateRowButton" class="btn btn-secondary" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Duplicate
            </button>
            <button id="exportButton" class="btn btn-secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Export
            </button>
            <button id="editRowButton" class="btn btn-secondary" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Edit
            </button>
            <button id="addRowButton" class="btn btn-primary" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add
            </button>
            <button id="deleteRowsButton" class="btn btn-danger" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Delete
            </button>
        </div>
    </div>

    <!-- Table Container -->
    <div class="table-wrapper">
        <div class="table-scroll">
            <table id="wsDataTable" class="ws-data-table">
                <thead id="tableHeader"></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container">
        <div class="pagination-controls">
            <button id="prevPageBtn" class="pagination-btn">Previous</button>
            <div id="pageNumbers" class="page-numbers"></div>
            <button id="nextPageBtn" class="pagination-btn">Next</button>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner-circle"></div>
            <p>Loading...</p>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" class="toast-container"></div>

<!-- Configuration Modal -->
<div id="configModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6M1 12h6m6 0h6M4.22 4.22l4.24 4.24m5.66 5.66 4.24 4.24m-4.24-14.14 4.24 4.24M4.22 19.78l4.24-4.24"></path>
                </svg>
                Configuration
            </h2>
            <button class="modal-close" onclick="closeConfigModal()">×</button>
        </div>
        <div class="modal-body">
            <div class="config-section">
                <h3>General Settings</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Worksheet Name</label>
                        <input type="text" id="configWorksheetName" class="form-control" placeholder="My Worksheet">
                    </div>
                    <div class="form-group">
                        <label>Theme</label>
                        <select id="configTheme" class="form-control">
                            <option value="auto">Auto</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Confluence Base URL</label>
                        <input type="text" id="configBaseUrl" class="form-control" placeholder="https://your-domain.atlassian.net/wiki">
                    </div>
                    <div class="form-group">
                        <label>Page ID</label>
                        <input type="text" id="configPageId" class="form-control" placeholder="123456789">
                    </div>
                </div>
                <div class="form-group">
                    <label>Authorized Users (comma-separated, leave empty for all users)</label>
                    <input type="text" id="configAuthorizedUsers" class="form-control" placeholder="user1, user2, user3">
                </div>
            </div>

            <div class="config-section">
                <h3>Tabs Configuration (Max 5)</h3>
                <div id="tabsConfigContainer"></div>
                <button id="addTabButton" class="btn btn-secondary btn-sm">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Tab
                </button>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeConfigModal()">Cancel</button>
            <button id="saveConfigButton" class="btn btn-primary">Save Configuration</button>
        </div>
    </div>
</div>

<!-- Filter Modal -->
<div id="filterModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
                Filter Columns
            </h2>
            <button class="modal-close" onclick="closeFilterModal()">×</button>
        </div>
        <div class="modal-body">
            <p class="help-text">Hold Ctrl (Cmd on Mac) to select multiple values</p>
            <div id="filterColumnsContainer" class="filter-columns-grid"></div>
            <div class="filter-status">
                <span id="filterStatus">No filters active</span>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="clearFilters()">Clear All</button>
            <button id="applyFiltersButton" class="btn btn-primary">Apply Filters</button>
        </div>
    </div>
</div>

<!-- Custom Fields Modal -->
<div id="commentModal" class="modal">
    <div class="modal-content modal-medium">
        <div class="modal-header">
            <h2>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                Update Custom Fields for <span id="commentRowCount">0</span> Row(s)
            </h2>
            <button class="modal-close" onclick="closeCommentModal()">×</button>
        </div>
        <div class="modal-body" id="commentFormContainer"></div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeCommentModal()">Cancel</button>
            <button id="saveCommentButton" class="btn btn-primary">Save Custom Fields</button>
        </div>
    </div>
</div>

<!-- Edit Row Modal -->
<div id="editRowModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="editRowTitle">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Edit Row
            </h2>
            <button class="modal-close" onclick="closeEditRowModal()">×</button>
        </div>
        <div class="modal-body" id="editRowFormContainer"></div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeEditRowModal()">Cancel</button>
            <button id="saveRowButton" class="btn btn-primary">Save</button>
        </div>
    </div>
</div>

<!-- History Modal -->
<div id="historyModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="1 4 1 10 7 10"></polyline>
                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                </svg>
                Change History
            </h2>
            <button class="modal-close" onclick="closeHistoryModal()">×</button>
        </div>
        <div class="modal-body">
            <div id="historyContainer"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeHistoryModal()">Close</button>
        </div>
    </div>
</div>

<!-- Confirm Modal -->
<div id="confirmModal" class="modal">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h2>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                Confirm Action
            </h2>
            <button class="modal-close" onclick="closeConfirmModal()">×</button>
        </div>
        <div class="modal-body">
            <p id="confirmMessage"></p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeConfirmModal()">Cancel</button>
            <button id="confirmButton" class="btn btn-danger">Confirm</button>
        </div>
    </div>
</div>

<script src="worksheet_optimized.js"></script>
</body>
</html>
